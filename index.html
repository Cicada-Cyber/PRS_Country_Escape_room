<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRS Genomics Lab Escape Room</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Start Screen -->
        <div id="start-screen" class="">
            <div class="emergency-header">
                <h1>üö® EMERGENCY: LAB LOCKDOWN PROTOCOL ACTIVATED üö®</h1>
                <h2>PRS Genomics Laboratory</h2>
            </div>
            
            <div class="room">
                <h2>üß¨ SYSTEM BREACH DETECTED</h2>
                <p style="font-size: 18px; margin: 20px 0;">
                    ‚Ä¢ Genomics Lab secured under emergency protocols<br>
                    ‚Ä¢ All data analysis suspended<br>
                    ‚Ä¢ <strong>YOUR MISSION:</strong> Solve 4 critical genomic puzzles to restore lab access<br>
                    ‚Ä¢ <strong>TIME LIMIT:</strong> 10 minutes before backup systems activate
                </p>
                
                <button class="btn" onclick="startIntro()">üöÄ START ESCAPE SEQUENCE</button>
            </div>
        </div>

        <!-- Intro Timer Screen -->
        <div id="intro-screen" class="hidden">
            <div class="emergency-header">
                <h1>üìã MISSION BRIEFING IN PROGRESS</h1>
            </div>
            
            <div class="timer" id="intro-timer">0:30</div>
            
            <div class="room">
                <h2>‚è∞ Instructor Introduction Time</h2>
                <p style="font-size: 18px;">
                    Use this time for your introduction and explanation of the workshop content.
                    The challenges will automatically begin when the timer reaches zero.
                </p>
                
                <div style="background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h3>üéØ Your Escape Route: 4 Digital Challenges</h3>
                    <ol style="text-align: left; font-size: 16px; margin: 15px 0;">
                        <li><strong>üß¨ Population Decoder</strong> - Solve the admixture mystery</li>
                        <li><strong>üî¨ RFMix Analyzer</strong> - Crack the ancestry assignment code</li>
                        <li><strong>üë®‚Äçüî¨ Guest Expert Intel</strong> - Decode Prof O'Reilly's key message</li>
                        <li><strong>üìä PRS Benchmarking</strong> - Choose the optimal framework</li>
                    </ol>
                    <p><strong>Each challenge gives you ONE digit of the 4-digit escape code!</strong></p>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="intro-progress"></div>
                </div>
            </div>
        </div>

        <!-- Main Game Screen -->
        <div id="game-screen" class="hidden">
            <div class="emergency-header">
                <h1>üî¨ GENOMICS LAB ESCAPE ROOM</h1>
                <div class="timer" id="game-timer">8:00</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="game-progress"></div>
                </div>
            </div>

            <!-- Challenge 1: Admixture -->
            <div class="room" id="challenge1">
                <h2>üß¨ CHALLENGE 1: POPULATION DECODER</h2>
                <div class="challenge">
                    <h3>ADMIXTURE EMERGENCY - Match the Global Ancestry Proportions!</h3>
                    <p>The lab's population analysis system has been corrupted. Restore the correct global ancestry proportions to unlock the first security code.</p>
                    
                    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h4>üéØ TARGET PROPORTIONS:</h4>
                        <p><span style="color: #ff6b6b;">‚ñ†</span> European: 45% | <span style="color: #4ecdc4;">‚ñ†</span> African: 35% | <span style="color: #45b7d1;">‚ñ†</span> Asian: 20%</p>
                    </div>
                    
                    <div class="slider-container">
                        <label>European Ancestry: <span id="eur-value">33</span>%</label>
                        <input type="range" class="slider" id="european" min="0" max="100" value="33" style="background: #ff6b6b;">
                    </div>
                    
                    <div class="slider-container">
                        <label>African Ancestry: <span id="afr-value">33</span>%</label>
                        <input type="range" class="slider" id="african" min="0" max="100" value="33" style="background: #4ecdc4;">
                    </div>
                    
                    <div class="slider-container">
                        <label>Asian Ancestry: <span id="asn-value">34</span>%</label>
                        <input type="range" class="slider" id="asian" min="0" max="100" value="34" style="background: #45b7d1;">
                    </div>
                    
                    <p><strong>Total: <span id="total-percentage">100</span>%</strong></p>
                    
                    <button class="btn" onclick="checkAdmixture()" id="admixture-btn">üîì DECODE SEQUENCE</button>
                    <div id="challenge1-result"></div>
                </div>
            </div>

            <!-- Challenge 2: RFMix -->
            <div class="room locked" id="challenge2">
                <h2>üî¨ CHALLENGE 2: RFMIX ANALYZER</h2>
                <div class="challenge">
                    <h3>LOCAL ANCESTRY ASSIGNMENT CRITICAL ERROR</h3>
                    <p>The RFMix system needs recalibration. First select an ancestry type, then click chromosome segments to assign them.</p>
                    
                    <div class="ancestry-options">
                        <button class="ancestry-btn european" onclick="selectAncestry('european')">
                            üß¨ European
                        </button>
                        <button class="ancestry-btn african" onclick="selectAncestry('african')">
                            üß¨ African
                        </button>
                        <button class="ancestry-btn asian" onclick="selectAncestry('asian')">
                            üß¨ Asian
                        </button>
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <p><strong>Step 1:</strong> Click an ancestry button above to select it</p>
                        <p><strong>Step 2:</strong> Click chromosome segments below to assign the selected ancestry</p>
                        <p><strong>Current Selection:</strong> <span id="selected-ancestry" style="color: #4ecdc4; font-weight: bold;">None Selected</span></p>
                        <p><strong>Progress:</strong> Need 6 out of 8 segments correct to proceed</p>
                    </div>
                    
                    <div class="ancestry-segments" id="segments">
                        <button class="segment unassigned" data-correct="european" onclick="assignSegment(0)">
                            Segment 1<br><small>Click to assign</small>
                        </button>
                        <button class="segment unassigned" data-correct="african" onclick="assignSegment(1)">
                            Segment 2<br><small>Click to assign</small>
                        </button>
                        <button class="segment unassigned" data-correct="asian" onclick="assignSegment(2)">
                            Segment 3<br><small>Click to assign</small>
                        </button>
                        <button class="segment unassigned" data-correct="european" onclick="assignSegment(3)">
                            Segment 4<br><small>Click to assign</small>
                        </button>
                        <button class="segment unassigned" data-correct="african" onclick="assignSegment(4)">
                            Segment 5<br><small>Click to assign</small>
                        </button>
                        <button class="segment unassigned" data-correct="asian" onclick="assignSegment(5)">
                            Segment 6<br><small>Click to assign</small>
                        </button>
                        <button class="segment unassigned" data-correct="european" onclick="assignSegment(6)">
                            Segment 7<br><small>Click to assign</small>
                        </button>
                        <button class="segment unassigned" data-correct="african" onclick="assignSegment(7)">
                            Segment 8<br><small>Click to assign</small>
                        </button>
                    </div>
                    
                    <button class="btn" onclick="checkRFMix()" id="rfmix-btn" disabled>üîì ANALYZE SEGMENTS</button>
                    <div id="challenge2-result"></div>
                </div>
            </div>

            <!-- Challenge 3: Guest Speaker -->
            <div class="room locked" id="challenge3">
                <h2>üë®‚Äçüî¨ CHALLENGE 3: GUEST EXPERT INTEL</h2>
                <div class="challenge">
                    <h3>PROF O'REILLY'S ENCRYPTED MESSAGE</h3>
                    <p>Decode the key insights from yesterday's guest lecture on "Using PRS to Find Rare Variants and Pathways"</p>
                    
                    <div style="margin: 20px 0;">
                        <h4>Question 1: What does PRS help identify beyond common variants?</h4>
                        <div class="quiz-option" onclick="selectQuizOption(0, 0)" id="q1-0">A) Only common variants</div>
                        <div class="quiz-option" onclick="selectQuizOption(0, 1)" id="q1-1">B) Rare variants and pathways</div>
                        <div class="quiz-option" onclick="selectQuizOption(0, 2)" id="q1-2">C) Population structure only</div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <h4>Question 2: What's key to avoiding false associations (like tea and schizophrenia)?</h4>
                        <div class="quiz-option" onclick="selectQuizOption(1, 0)" id="q2-0">A) Larger sample sizes</div>
                        <div class="quiz-option" onclick="selectQuizOption(1, 1)" id="q2-1">B) Understanding pathways</div>
                        <div class="quiz-option" onclick="selectQuizOption(1, 2)" id="q2-2">C) More SNPs</div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <h4>Question 3: What does PRSet provide?</h4>
                        <div class="quiz-option" onclick="selectQuizOption(2, 0)" id="q3-0">A) Standard PRS</div>
                        <div class="quiz-option" onclick="selectQuizOption(2, 1)" id="q3-1">B) Pathway-based PRS analysis</div>
                        <div class="quiz-option" onclick="selectQuizOption(2, 2)" id="q3-2">C) Population stratification</div>
                    </div>
                    
                    <button class="btn" onclick="checkQuiz()" id="quiz-btn" disabled>üîì DECRYPT MESSAGE</button>
                    <div id="challenge3-result"></div>
                </div>
            </div>

            <!-- Challenge 4: Benchmarking -->
            <div class="room locked" id="challenge4">
                <h2>üìä CHALLENGE 4: PRS BENCHMARKING COMMAND CENTER</h2>
                <div class="challenge">
                    <h3>FRAMEWORK SELECTION CRITICAL</h3>
                    <p>Choose the optimal ranking for PRS frameworks in cross-population analysis. Rank 1-3 (1=best for portability across populations)</p>
                    
                    <div class="framework-ranking">
                        <div class="framework">
                            <div>
                                <strong>BridgePRS</strong><br>
                                <small>Two-stage Bayesian method for cross-population PRS</small><br>
                                Portability: <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span> | Speed: <span class="stars">‚≠ê‚≠ê‚≠ê</span>
                            </div>
                            <input type="number" class="ranking-input" id="bridge-rank" min="1" max="3" placeholder="Rank">
                        </div>
                        
                        <div class="framework">
                            <div>
                                <strong>PRS-CSx</strong><br>
                                <small>Cross-population polygenic prediction</small><br>
                                Portability: <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê</span> | Speed: <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                            </div>
                            <input type="number" class="ranking-input" id="csx-rank" min="1" max="3" placeholder="Rank">
                        </div>
                        
                        <div class="framework">
                            <div>
                                <strong>Standard PRS</strong><br>
                                <small>Traditional single-population approach</small><br>
                                Portability: <span class="stars">‚≠ê‚≠ê</span> | Speed: <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                            </div>
                            <input type="number" class="ranking-input" id="standard-rank" min="1" max="3" placeholder="Rank">
                        </div>
                    </div>
                    
                    <button class="btn" onclick="checkBenchmarking()" id="benchmark-btn" disabled>üîì VALIDATE FRAMEWORK</button>
                    <div id="challenge4-result"></div>
                </div>
            </div>

            <!-- Final Escape -->
            <div class="room locked" id="final-escape">
                <h2>üö™ FINAL ESCAPE SEQUENCE</h2>
                <div class="challenge">
                    <h3>LAB UNLOCK PROTOCOL</h3>
                    <p>Enter your 4-digit escape code to unlock the genomics lab!</p>
                    
                    <div class="code-display">
                        COLLECTED DIGITS: <span id="collected-codes">_ _ _ _</span>
                    </div>
                    
                    <input type="text" class="code-input" id="final-code" maxlength="4" placeholder="CODE" disabled>
                    <br>
                    <button class="btn" onclick="checkFinalCode()" id="final-btn" disabled>üîì UNLOCK LAB</button>
                    <div id="final-result"></div>
                </div>
            </div>
        </div>

        <!-- Success Screen -->
        <div id="success-screen" class="hidden">
            <div class="emergency-header success">
                <h1>üèÜ LAB SUCCESSFULLY UNLOCKED! üèÜ</h1>
                <h2>GENOMICS HEROES - MISSION ACCOMPLISHED!</h2>
            </div>
            
            <div class="room success">
                <h2>üéâ WEEK RECAP ACHIEVED:</h2>
                <div style="text-align: left; font-size: 18px; margin: 20px 0;">
                    <p>‚úÖ <strong>Admixture:</strong> Global and local ancestry analysis</p>
                    <p>‚úÖ <strong>RFMix:</strong> Local ancestry inference for admixed populations</p>
                    <p>‚úÖ <strong>Guest Lecture:</strong> Using PRS to find rare variants and pathways</p>
                    <p>‚úÖ <strong>Benchmarking:</strong> Frameworks for cross-population PRS validation</p>
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h3>üß¨ How It All Connects:</h3>
                    <p style="text-align: left; margin: 15px 0;">
                        <strong>Admixture</strong> reveals population structure that affects PRS accuracy ‚Üí
                        <strong>RFMix</strong> provides local ancestry needed for admixture-informed PRS ‚Üí
                        <strong>Pathway analysis</strong> helps avoid false associations ‚Üí
                        <strong>Benchmarking frameworks</strong> ensure PRS work across diverse populations
                    </p>
                    <h4 style="color: #4ecdc4;">= Better Precision Medicine for All! üåç</h4>
                </div>
                
                <button class="btn" onclick="resetGame()">üîÑ PLAY AGAIN</button>
            </div>
        </div>
    </div>

    <script src="script.js" defer></script>
</body>
</html>